============================= test session starts =============================
platform win32 -- Python 3.10.16, pytest-8.4.0, pluggy-1.6.0 -- C:\Users\JM\AppData\Local\anaconda3\envs\ENV_STONE\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\JM\Documents\0_CienciaDados\1_Frameworks\Vassoura
configfile: pyproject.toml
plugins: anyio-4.9.0
collecting ... collected 4 items

vassoura/tests/test_vif.py::test_vif_numeric_high_corr PASSED            [ 25%]
vassoura/tests/test_vif.py::test_vif_handles_categorical[only_cat] FAILED [ 50%]
vassoura/tests/test_vif.py::test_vif_handles_categorical[mixed] FAILED   [ 75%]
vassoura/tests/test_vif.py::test_vif_no_numeric_columns_raises PASSED    [100%]

================================== FAILURES ===================================
___________________ test_vif_handles_categorical[only_cat] ____________________

all_categorical = True

    @pytest.mark.parametrize("all_categorical", [True, False], ids=["only_cat", "mixed"])
    def test_vif_handles_categorical(all_categorical):
        """DataFrames com categóricas (todas ou parcialmente) não explodem."""
        df = _categorical_dataset(all_categorical=all_categorical)
    
        vif = compute_vif(
            df,
            target_col="target",
            limite_categorico=10,  # força detecção categórica
            verbose="none",
        )
    
        exp_vars = {"cat1", "cat2", "cat3"} | ({"num1"} if not all_categorical else set())
        assert exp_vars == set(vif["variable"])
        assert np.isfinite(vif["vif"]).all()  # sem inf / nan
    
        # Como cat1 e cat2 têm alta dependência, pelo menos uma deve estar inflada
>       assert vif.loc[vif["variable"].isin({"cat1", "cat2"}), "vif"].max() > 5
E       assert 2.3765410691547553 > 5
E        +  where 2.3765410691547553 = max()
E        +    where max = 0    2.376541\n1    2.365958\nName: vif, dtype: float64.max

vassoura\tests\test_vif.py:75: AssertionError
_____________________ test_vif_handles_categorical[mixed] _____________________

all_categorical = False

    @pytest.mark.parametrize("all_categorical", [True, False], ids=["only_cat", "mixed"])
    def test_vif_handles_categorical(all_categorical):
        """DataFrames com categóricas (todas ou parcialmente) não explodem."""
        df = _categorical_dataset(all_categorical=all_categorical)
    
        vif = compute_vif(
            df,
            target_col="target",
            limite_categorico=10,  # força detecção categórica
            verbose="none",
        )
    
        exp_vars = {"cat1", "cat2", "cat3"} | ({"num1"} if not all_categorical else set())
        assert exp_vars == set(vif["variable"])
        assert np.isfinite(vif["vif"]).all()  # sem inf / nan
    
        # Como cat1 e cat2 têm alta dependência, pelo menos uma deve estar inflada
>       assert vif.loc[vif["variable"].isin({"cat1", "cat2"}), "vif"].max() > 5
E       assert 1.3945007704827779 > 5
E        +  where 1.3945007704827779 = max()
E        +    where max = 0    1.394501\n1    1.392517\nName: vif, dtype: float64.max

vassoura\tests\test_vif.py:75: AssertionError
=========================== short test summary info ===========================
FAILED vassoura/tests/test_vif.py::test_vif_handles_categorical[only_cat] - assert 2.3765410691547553 > 5
 +  where 2.3765410691547553 = max()
 +    where max = 0    2.376541\n1    2.365958\nName: vif, dtype: float64.max
FAILED vassoura/tests/test_vif.py::test_vif_handles_categorical[mixed] - assert 1.3945007704827779 > 5
 +  where 1.3945007704827779 = max()
 +    where max = 0    1.394501\n1    1.392517\nName: vif, dtype: float64.max
========================= 2 failed, 2 passed in 2.62s =========================
